import hashlib, json, time

class IoTBlockchain:
    def __init__(self):
        self.chain = []
        self.authorized_devices = ["device_01", "device_02", "device_03"]  
        self.create_block(proof=1, previous_hash='0')

    def create_block(self, proof, previous_hash):
        block = {
            'index': len(self.chain) + 1,
            'timestamp': time.time(),
            'proof': proof,
            'previous_hash': previous_hash,
            'authorized_devices': self.authorized_devices.copy()
        }
        self.chain.append(block)
        return block

    def get_previous_block(self):
        return self.chain[-1]

    def proof_of_work(self, previous_proof):
        new_proof = 1
        while True:
            hash_operation = hashlib.sha256(str(new_proof**2 - previous_proof**2).encode()).hexdigest()
            if hash_operation[:4] == '0000':  
                return new_proof
            new_proof += 1

    def hash(self, block):
        return hashlib.sha256(json.dumps(block, sort_keys=True).encode()).hexdigest()

    def is_device_authorized(self, device_id):
        return device_id in self.get_previous_block()['authorized_devices']

blockchain = IoTBlockchain()
print("Genesis Block Created with Authorized Device List")

for i in range(2):
    prev_block = blockchain.get_previous_block()
    proof = blockchain.proof_of_work(prev_block['proof'])
    prev_hash = blockchain.hash(prev_block)
    blockchain.create_block(proof, prev_hash)
print("\nBlockchain Ready! You can now test IoT device authentication.")

while True:
    user_input = input("\nEnter Device ID to authenticate (or type 'exit' to quit): ").strip()

    if user_input.lower() == "exit":
        print("Exiting authentication system...")
        break

    if blockchain.is_device_authorized(user_input):
        print(f"Device '{user_input}' authenticated successfully! Data accepted.")
    else:
        print(f"Device '{user_input}' is NOT authorized. Data rejected.")
